@model GestionPlazasVacantes.Models.PlazaVacante
@{
    ViewData["Title"] = "Detalle de Plaza";
    var postulantes = ViewBag.Postulantes as List<GestionPlazasVacantes.Models.Postulante> ?? new();
    bool cerrada = !(Model.Estado == "Abierta" && Model.FechaLimite > DateTime.Now);
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />



<div class="wrap container-fluid">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="title"><i class="bi bi-briefcase"></i> @Model.Titulo</h2>
        <a class="btn btn-outline-secondary" asp-action="Index">
            <i class="bi bi-arrow-left"></i> Volver al dashboard
        </a>
    </div>

    <!-- Información de la plaza -->
    <div class="card mb-4">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="pill mb-2">
                    <i class="bi bi-building"></i> @Model.Departamento
                </div><br />
                <div><strong>Tipo:</strong> @Model.TipoConcurso Nº @Model.NumeroConcurso</div>
                <div><strong>Horario:</strong> @Model.Horario</div>
            </div>
            <div class="col-md-6 text-md-end">
                <div><strong>Fecha límite:</strong> @Model.FechaLimite.ToString("dd/MM/yyyy") — @Model.FechaLimite.ToString("hh:mm tt")</div>
                <div class="mt-2">
                    <span class="pill @(cerrada ? "badge-closed" : "")">
                        <i class="bi @(cerrada ? "bi-x-octagon" : "bi-check-circle")"></i>
                        @(cerrada ? "Cerrada" : "Abierta")
                    </span>
                </div>
            </div>
        </div>

        <hr />

        <div class="mb-2"><strong>Requisitos</strong></div>
        <p>@Model.Requisitos</p>

        @if (!string.IsNullOrWhiteSpace(Model.Observaciones))
        {
            <div class="mb-2"><strong>Observaciones</strong></div>
            <p>@Model.Observaciones</p>
        }
    </div>

    <!-- Listado de postulantes -->
    <div class="card">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h5 class="m-0" style="color:#435563;">
                <i class="bi bi-people"></i> Postulantes (@postulantes.Count)
            </h5>
        </div>

        @if (postulantes.Count == 0)
        {
            <p class="text-muted fst-italic">Aún no hay postulantes para esta plaza.</p>
        }
        else
        {
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Cédula</th>
                            <th>Correo</th>
                            <th>Teléfono</th>
                            <th>Estado</th>
                            <th>Actualización</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var p in postulantes)
                        {
                            <tr>
                                <td>@p.NombreCompleto</td>
                                <td>@p.Cedula</td>
                                <td>@p.Correo</td>
                                <td>@p.Telefono</td>
                                <td>@p.EstadoProceso</td>
                                <td>@p.FechaActualizacion.ToString("dd/MM/yyyy hh:mm tt")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
